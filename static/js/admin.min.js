!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("jquery"),e=a("fastclick"),f=a("./router");window.app.now=new Date,d(function(){e(document.body),window.app.router=new f,window.app.router.start()})},{"./router":4,fastclick:"fastclick",jquery:"jquery"}],2:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone"));d.$=a("jquery"),b.exports=d.Collection.extend({url:"/api/terminals",model:a("../models/terminal"),parse:function(a){return a.data}})},{"../models/terminal":3,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],3:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone"));d.$=a("jquery"),b.exports=d.Model.extend({urlRoot:"/api/terminals",parse:function(a){return a.data&&a.url?a.data:a}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],4:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone")),e=a("jeolok");d.$=a("jquery");var f,g=a("./views/main"),h=a("./views/header"),i=a("./views/terminals-list"),j=a("./views/terminal-details"),k=a("./views/new-terminal"),l=a("./collections/terminals"),m=a("./models/terminal");b.exports=d.Router.extend({views:{},routes:{admin:"showAdminTerminalsList","admin/list":"showAdminTerminalsList","admin/newterminal":"showAdminNewTerminal","admin/list/:radius":"showAdminTerminalsList","admin/details/:id":"showAdminTerminalDetails"},start:function(){console.log("AdminRouter:started"),(this.views.main=new g).render(),this.views.main.initAdminHeader((this.views.header=new h).render()),e.getCurrentPosition({enableHighAccuracy:!0,timeout:500},function(a,b){f=a||!b?{latitude:50.84275,longitude:4.35154}:b.coords,window.app.currentPosition=f,d.history.start({pushState:!0})})},showAdminTerminalsList:function(a){console.log("showAdminTerminalsList"),console.log(new i);var b=this;this.views.main.loading(!0);var c=new l;(this.views.list=new i(f,c,a)).collection.fetch({data:{latitude:f.latitude,longitude:f.longitude,radius:a},success:function(){b.views.main.clearContent(),b.views.main.initAdminList(b.views.list.render()),b.views.main.loading(!1,"Liste des distributeurs")}})},showAdminTerminalDetails:function(a){console.log("showAdminTerminalDetails");var b=this;this.views.main.loading(!0);var c=new m({id:a});(this.views.details=new j(f,c)).model.fetch({success:function(){b.views.main.clearContent(),b.views.main.initAdminDetails(b.views.details.render()),b.views.main.loading(!1,"DÃ©tails sur le distributeur")}})},showAdminNewTerminal:function(){console.log("showAdminNewTerminal");var a=this;this.views.main.loading(!0);var b=new m;(this.views.newTerminal=new k(f,b)).model.fetch({data:{latitude:f.latitude,longitude:f.longitude},success:function(){a.views.main.clearContent(),a.views.main.initAdminNewTerminal(a.views.newTerminal.render()),a.views.main.loading(!1,"Ajouter un nouveau terminal")}})}})},{"./collections/terminals":2,"./models/terminal":3,"./views/header":5,"./views/main":6,"./views/new-terminal":7,"./views/terminal-details":8,"./views/terminals-list":10,backbone:"backbone",jeolok:"jeolok",jquery:"jquery",underscore:"underscore"}],5:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone")),e=a("jquery");d.$=a("jquery");var f;b.exports=d.View.extend({el:"<div />",constructor:function(){d.View.apply(this,arguments),console.log("AdminHeaderView:init()"),f||(f=e("#tpl-header").remove().text())},events:{"click #reload":"reloadList","click #back":"backList"},render:function(){return this.$el.html(f),this.$status=this.$el.find("#status h2"),this},loading:function(a){this.$el.find("#status").toggleClass("loading",a)},getStatus:function(){return this.$status.text()},setStatus:function(a){this.$status.text(a)},reloadList:function(a){a.preventDefault(),d.history.loadUrl(d.history.fragment)},backList:function(a){a.preventDefault(),window.app.router.navigate("admin",{trigger:!0})}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],6:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone")),e=a("jquery");d.$=a("jquery"),b.exports=d.View.extend({el:"body",$el:e("body"),constructor:function(){d.View.apply(this,arguments),console.log("AdminMainView:init()")},loading:function(a,b){a?(this._status=window.app.router.views.header.getStatus(),window.app.router.views.header.loading(!0),window.app.router.views.header.setStatus(b||"chargement...")):(window.app.router.views.header.loading(!1),window.app.router.views.header.setStatus(b))},initAdminHeader:function(a){this.$el.find("#main").append(a.$el)},clearContent:function(){this.$el.find("#main section:not(#status)").remove()},initAdminList:function(a){this.$el.find("#main").append(a.$el)},initAdminDetails:function(a){this.$el.find("#main").append(a.$el)},initAdminNewTerminal:function(a){this.$el.find("#main").append(a.$el)}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],7:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone")),e=a("jquery");a("jeyo-distans");d.$=a("jquery");var f;b.exports=d.View.extend({el:"<section />",constructor:function(a){d.View.apply(this,arguments),this.position=a,console.log("NewTerminalView:init()"),f||(f=e("#tpl-newDistrib").remove().text())},events:{},render:function(){e("#back").show();({latitude:this.model.get("latitude"),longitude:this.model.get("longitude")});return this},create:function(){function a(a){var b=new google.maps.Geocoder;b.geocode({latLng:a},function(b,c){if(c==google.maps.GeocoderStatus.OK){var e=b[0].formatted_address,f=a.G,g=a.K;h.get("model").save(null,{url:"/api/terminals/"+h.get("model").get("id")+"/"+e+"/"+f+"/"+g+"/changeposition",success:function(){d.history.loadUrl(d.history.fragment)}})}})}var b=new google.maps.LatLng(this.position.latitude,this.position.longitude),c={zoom:15,zoomControl:!0,scrollwheel:!1,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP},e=new google.maps.Map(document.getElementById("gmap"),c),f=(new google.maps.Marker({position:b,title:"Ma position",map:e,icon:"/images/markers/me_marker.png",zIndex:2}),this.model.get("bank"),this.model.get("latitude")),g=this.model.get("longitude"),h=new google.maps.Marker({position:new google.maps.LatLng(f,g),title:this.model.get("bank").name,map:e,icon:"/images/markers/terminal_marker.png",animation:google.maps.Animation.BOUNCE,zIndex:1,draggable:!0});h.set("model",this.model),google.maps.event.addListener(h,"dragstart",function(){h.setAnimation(null)}),google.maps.event.addListener(h,"dragend",function(){a(h.getPosition())})}})},{backbone:"backbone","jeyo-distans":"jeyo-distans",jquery:"jquery",underscore:"underscore"}],8:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone")),e=a("jquery"),f=a("jeyo-distans");d.$=a("jquery");var g;b.exports=d.View.extend({el:"<section />",constructor:function(a,b){d.View.apply(this,arguments),this.model=b,this.position=a,console.log("TerminalDetailsView:init()"),g||(g=e("#tpl-details").remove().text())},events:{"click #emptyTerminal":"toggleEmptyState","click #fullTerminal":"toggleFullState","click #wrongAddress":"changeInfos","click #wrongBank":"changeInfos","submit #changeAddress":"changeAddress","submit #changeBank":"changeBank"},render:function(){e("#back").show();var a=this.model.get("bank"),b={latitude:this.model.get("latitude"),longitude:this.model.get("longitude")};return this.$el.html(g).find(".details").find(".left").find("img").attr("src",a&&a.icon?"/images/banks/"+a.icon:"images/banks/unknown.png").attr("alt",a&&a.name?a.name:"Inconnu").end().find(".name").css("color","#"+(a&&a.color?a.color:"333")).text(a&&a.name?a.name:"Inconnu").end().find("address").css("color","#"+(a&&a.color?a.color:"333")).text(this.model.get("address")).end().end().find(".right").find(".distance").css("color","#"+(a&&a.color?a.color:"333")).text("+- "+(+f(b,this.position)+"km")).end().end(),1==this.model.get("empty")&&this.$el.find("#empty").show().end().find("#fullTerminal").css("display","block").end().find("#emptyTerminal").hide().end(),this.create(),this},create:function(){function a(a){var b=new google.maps.Geocoder;b.geocode({latLng:a},function(b,c){if(c==google.maps.GeocoderStatus.OK){var e=b[0].formatted_address,f=a.G,g=a.K;h.get("model").save(null,{url:"/api/terminals/"+h.get("model").get("id")+"/"+e+"/"+f+"/"+g+"/changeposition",success:function(){d.history.loadUrl(d.history.fragment)}})}})}var b=new google.maps.LatLng(this.position.latitude,this.position.longitude),c={zoom:15,zoomControl:!0,scrollwheel:!1,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP},e=new google.maps.Map(document.getElementById("gmap"),c),f=(new google.maps.Marker({position:b,title:"Ma position",map:e,icon:"/images/markers/me_marker.png",zIndex:2}),this.model.get("bank"),this.model.get("latitude")),g=this.model.get("longitude"),h=new google.maps.Marker({position:new google.maps.LatLng(f,g),title:this.model.get("bank").name,map:e,icon:"/images/markers/terminal_marker.png",animation:google.maps.Animation.BOUNCE,zIndex:1,draggable:!0});h.set("model",this.model),google.maps.event.addListener(h,"dragstart",function(){h.setAnimation(null)}),google.maps.event.addListener(h,"dragend",function(){a(h.getPosition())})},toggleEmptyState:function(a){a.preventDefault(),this.model.set("empty",!0),this.model.save(null,{url:"/api/terminals/"+this.model.get("id")+"/empty",success:function(){e("#empty").show(),e("#fullTerminal").css("display","block"),e("#emptyTerminal").hide()}})},toggleFullState:function(a){a.preventDefault(),this.model.set("empty",!1),this.model.save(null,{url:"/api/terminals/"+this.model.get("id")+"/full",success:function(){e("#empty").hide(),e("#fullTerminal").hide(),e("#emptyTerminal").show()}})},changeInfos:function(a){a.preventDefault(),"wrongAddress"==a.target.id?(e(".formulaire").hide(),e(".changeAddress").show()):(e(".formulaire").hide(),e(".changeBank").show())},changeAddress:function(a){a.preventDefault();var b=e("#address").val();this.model.save(null,{url:"/api/terminals/"+this.model.get("id")+"/"+b+"/changeaddress",success:function(){d.history.loadUrl(d.history.fragment)}})},changeBank:function(a){a.preventDefault();var b=e("#bankSelect").val();this.model.save(null,{url:"/api/terminals/"+this.model.get("id")+"/"+b+"/changebank",success:function(){d.history.loadUrl(d.history.fragment)}})}})},{backbone:"backbone","jeyo-distans":"jeyo-distans",jquery:"jquery",underscore:"underscore"}],9:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone")),e=a("jquery");d.$=a("jquery");var f;b.exports=d.View.extend({el:"<li />",constructor:function(a){d.View.apply(this,arguments),this.model=a,f||(f=e("#tpl-list-terminals").remove().text())},events:{"click a":"showTerminal"},render:function(){var a=this.model.get("bank");return this.$el.html(f).find(".details").find(".left").find("img").attr("src",a&&a.icon?"/images/banks/"+a.icon:"/images/banks/unknown.png").attr("alt",a&&a.name?a.name:"Inconnu").end().find(".name").css("color","#"+(a&&a.color?a.color:"333")).text(a&&a.name?a.name:"Inconnu").end().find("address").css("color","#"+(a&&a.color?a.color:"333")).text(this.model.get("address")).end().end().find(".right").find(".distance").css("color","#"+(a&&a.color?a.color:"333")).text("+- "+parseFloat(this.model.get("distance"))+"km").end().end(),this},showTerminal:function(a){a.preventDefault(),window.app.router.navigate("admin/details/"+this.model.get("id"),{trigger:!0})}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],10:[function(a,b,c){"use strict";var d=(a("underscore"),a("backbone")),e=a("jquery");d.$=a("jquery");var f,g=a("./terminals-list-element");b.exports=d.View.extend({el:"<section />",constructor:function(a,b,c){d.View.apply(this,arguments),this.collection=b,this.position=a,this.radius=c,null==this.radius&&(this.radius=5),console.log("AdminTerminalsListView:init()"),f||(f=e("#tpl-list").remove().text())},events:{"click #show":"showList","click #hide":"hideList","click #addTerminal":"addTerminal","change #radius":"changeRadius"},render:function(){return e("#back").hide(),this.$el.html(f).find("#radius").attr("value",this.radius).end().find("#radiusValue").text(this.radius+"km").end(),this.create(this.radius),this},create:function(a){var b=new google.maps.LatLng(this.position.latitude,this.position.longitude),c={zoom:8,zoomControl:!0,scrollwheel:!1,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP},d=new google.maps.Map(document.getElementById("gmap"),c),e=new google.maps.Marker({position:b,title:"Ma position",map:d,icon:"/images/markers/me_marker.png",zIndex:2,draggable:!0});google.maps.event.addListener(e,"dragend",function(){console.log(e.getPosition())});new google.maps.Circle({strokeColor:"#000c20",strokeOpacity:.8,strokeWeight:4,fillColor:"#ffffff",fillOpacity:.4,map:d,center:b,radius:1e3*this.radius});this.collection.each(function(a){var b=a,c=(b.get("bank"),b.get("latitude")),e=b.get("longitude");new google.maps.Marker({position:new google.maps.LatLng(c,e),map:d,icon:"/images/markers/terminal_marker.png",zIndex:1})})},showList:function(a){a.preventDefault(),this.$el.html(f).find("#radius").attr("value",this.radius).end().find("#radiusValue").text(this.radius+"km").end().find("#show").attr("class","hidden").end().find("#hide").attr("class","shown").end().find("ul").show().end();var b=this.$el.find("ul");this.collection.each(function(a){new g(a).render().$el.appendTo(b)})},hideList:function(a){a.preventDefault(),this.$el.html(f).find("#radius").attr("value",this.radius).end().find("#radiusValue").text(this.radius+"km").end().find("#show").attr("class","shown").end().find("#hide").attr("class","hidden").end().find("ul").hide().end()},changeRadius:function(a){a.preventDefault();var b=e("#radius").val();window.app.router.navigate("admin/list/"+b,{trigger:!0})},addTerminal:function(a){a.preventDefault(),window.app.router.navigate("admin/newterminal",{trigger:!0})}})},{"./terminals-list-element":9,backbone:"backbone",jquery:"jquery",underscore:"underscore"}]},{},[1]);
//# sourceMappingURL=admin.min.js.map