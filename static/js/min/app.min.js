!function e(t,n,i){function s(r,a){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[r]={exports:{}};t[r][0].call(d.exports,function(e){var n=t[r][1][e];return s(n?n:e)},d,d.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)s(i[r]);return s}({1:[function(e){"use strict";var t=e("jquery"),n=e("fastclick"),i=e("./router");window.app.now=new Date,t(function(){n(document.body),console.log(window.app),console.log("ready."),window.app.router=new i,window.app.router.start()})},{"./router":4,fastclick:"fastclick",jquery:"jquery"}],2:[function(e,t){"use strict";var n=(e("underscore"),e("backbone"));n.$=e("jquery"),t.exports=n.Collection.extend({url:"/api/terminals",model:e("../models/terminal"),parse:function(e){return e.data}})},{"../models/terminal":3,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],3:[function(e,t){"use strict";var n=(e("underscore"),e("backbone"));n.$=e("jquery"),t.exports=n.Model.extend({urlRoot:"/api/terminals",parse:function(e){return e.data&&e.url?e.data:e}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],4:[function(e,t){"use strict";var n=(e("underscore"),e("backbone")),i=e("jeolok");n.$=e("jquery");var s,o=e("./views/main"),r=e("./views/header"),a=e("./collections/terminals"),l=e("./models/terminal"),c=e("./views/terminals-list"),d=e("./views/terminal-details"),u=e("./views/admin");t.exports=n.Router.extend({views:{admin:"showAdmin"},routes:{"terminals/list":"showTerminalsList","terminals/map":"showTerminalsMap","terminals/details/:id":"showTerminalDetails","":"showTerminalsList"},start:function(){console.log("Router:started"),(this.views.main=new o).render(),this.views.main.initHeader((this.views.header=new r).render()),i.getCurrentPosition({enableHighAccuracy:!0,timeout:500},function(e,t){s=e||!t?{latitude:50.84275,longitude:4.35154}:t.coords,window.app.currentPosition=s,n.history.start({pushState:!0})})},showTerminalsList:function(){console.log("showTerminalsList");var e=this;this.views.main.loading(!0);var t=new a;(this.views.list=new c(t)).collection.fetch({data:{latitude:s.latitude,longitude:s.longitude},success:function(){e.views.main.clearContent(),e.views.main.initList(e.views.list.render()),e.views.main.loading(!1,t.length+" distributeurs à proximité")}})},showTerminalsMap:function(){console.log("showTerminalsMap")},showTerminalDetails:function(e){console.log("showTerminalDetails:",e);var t=this;this.views.main.loading(!0);var n=new l({id:e});(this.views.details=new d(n)).model.fetch({success:function(){t.views.main.clearContent(),t.views.main.initDetails(t.views.details.render()),t.views.main.loading(!1)}})},showAdmin:function(){console.log("showAdmin");var e=this;this.views.main.loading(!0);var t=new a;(this.views.list=new u(t)).collection.fetch({data:{latitude:s.latitude,longitude:s.longitude},success:function(){e.views.main.clearContent(),e.views.main.initList(e.views.list.render()),e.views.main.loading(!1,t.length+" distributeurs à proximité")}})}})},{"./collections/terminals":2,"./models/terminal":3,"./views/admin":5,"./views/header":6,"./views/main":7,"./views/terminal-details":8,"./views/terminals-list":10,backbone:"backbone",jeolok:"jeolok",jquery:"jquery",underscore:"underscore"}],5:[function(e,t){"use strict";var n=(e("underscore"),e("backbone")),i=e("jquery");n.$=e("jquery");var s,o=e("./terminals-list-element");t.exports=n.View.extend({el:"<section />",constructor:function(e){n.View.apply(this,arguments),this.collection=e,console.log("AdminView:init()"),s||(s=i("#tpl-admin").remove().text())},events:{},render:function(){this.$el.attr("id","result").html(s);var e=this.$el.find("ul");return this.collection.each(function(t){new o(t).render().$el.appendTo(e)}),this}})},{"./terminals-list-element":9,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],6:[function(e,t){"use strict";var n=(e("underscore"),e("backbone")),i=e("jquery");n.$=e("jquery");var s;t.exports=n.View.extend({el:"<div />",constructor:function(){n.View.apply(this,arguments),console.log("HeaderView:init()"),s||(s=i("#tpl-header").remove().text())},events:{"click #reload":"reloadButtonClicked","click #admin":"showAdmin"},render:function(){return this.$el.html(s).find("#back").hide().end(),this.$status=this.$el.find("#status h3"),this},loading:function(e){this.$el.find("#status").toggleClass("loading",e)},getStatus:function(){return this.$status.text()},setStatus:function(e){this.$status.text(e)},reloadButtonClicked:function(e){e.preventDefault(),console.log("reloadButtonClicked")}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],7:[function(e,t){"use strict";var n=(e("underscore"),e("backbone")),i=e("jquery");n.$=e("jquery"),t.exports=n.View.extend({el:"body",$el:i("body"),constructor:function(){n.View.apply(this,arguments),console.log("MainView:init()")},loading:function(e,t){e?(this._status=window.app.router.views.header.getStatus(),window.app.router.views.header.loading(!0),window.app.router.views.header.setStatus(t||"chargement...")):(window.app.router.views.header.loading(!1),window.app.router.views.header.setStatus(t))},initHeader:function(e){this.$el.find("#main").append(e.$el)},clearContent:function(){this.$el.find("#main section:not(#status)").remove()},initList:function(e){this.$el.find("#main").append(e.$el)},initDetails:function(e){this.$el.find("#main").append(e.$el)}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],8:[function(e,t){"use strict";var n=(e("underscore"),e("backbone")),i=e("jquery"),s=e("jeyo-distans");n.$=e("jquery");var o;t.exports=n.View.extend({el:"<section />",constructor:function(e){n.View.apply(this,arguments),this.model=e,console.log("TerminalDetailsView:init()"),o||(o=i("#tpl-details").remove().text())},events:{"click .problems a":"toggleEmptyState"},render:function(){var e=this.model.get("bank"),t={latitude:this.model.get("latitude"),longitude:this.model.get("longitude")};return this.$el.html(o).attr("id","details").show().find("h3").find("img").attr("src",e&&e.icon?"/images/banks/"+e.icon:"images/banks/unknown.png").attr("alt",e&&e.name?e.name:"Inconnu").end().find("span").css("color","#"+(e&&e.color?e.color:"333")).text(e&&e.name?e.name:"Inconnu").end().end().find("address").text(this.model.get("address")).end().find(".empty").toggle(this.model.get("empty")).end().find(".infos").css("position","relative").css("right","auto").css("top","auto").find("> span").text(1e3*s(t,window.app.currentPosition)+"m").end().end().find(".problems").toggle(!this.model.get("empty")).end().find(".confirm_problem").hide(),this},toggleEmptyState:function(e){e.preventDefault();var t=this;this.model.set("empty",!1),this.model.save(null,{url:"/api/terminals/"+this.model.get("id")+"/empty",success:function(){t.$el.find("empty").show().end().find(".problems").hide()}})}})},{backbone:"backbone","jeyo-distans":"jeyo-distans",jquery:"jquery",underscore:"underscore"}],9:[function(e,t){"use strict";var n=(e("underscore"),e("backbone")),i=e("jquery");n.$=e("jquery");var s;t.exports=n.View.extend({el:"<li />",constructor:function(e){n.View.apply(this,arguments),this.model=e,s||(s=i("#tpl-result-list-elt").remove().text())},events:{"click a":"showTerminal"},render:function(){var e=this.model.get("bank");return this.$el.html(s).find(".details").find(".left").find("img").attr("src",e&&e.icon?"/images/banks/"+e.icon:"images/banks/unknown.png").attr("alt",e&&e.name?e.name:"Inconnu").end().find(".name").css("color","#"+(e&&e.color?e.color:"333")).text(e&&e.name?e.name:"Inconnu").end().find("address").css("color","#"+(e&&e.color?e.color:"333")).text(this.model.get("address")).end().end().find(".right").find(".distance").css("color","#"+(e&&e.color?e.color:"333")).text(1e3*parseFloat(this.model.get("distance"))+"m").end().end(),this},showTerminal:function(e){e.preventDefault(),window.app.router.navigate("terminals/details/"+this.model.get("id"),{trigger:!0})}})},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],10:[function(e,t){"use strict";var n=(e("underscore"),e("backbone")),i=e("jquery");n.$=e("jquery");var s,o=e("./terminals-list-element");t.exports=n.View.extend({el:"<section />",constructor:function(e){n.View.apply(this,arguments),this.collection=e,console.log("TerminalsListView:init()"),s||(s=i("#tpl-result-list").remove().text())},events:{},render:function(){this.$el.attr("id","result").html(s);var e=this.$el.find("ul");return this.collection.each(function(t){new o(t).render().$el.appendTo(e)}),this}})},{"./terminals-list-element":9,backbone:"backbone",jquery:"jquery",underscore:"underscore"}]},{},[1]);